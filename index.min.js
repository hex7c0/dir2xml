"use strict";function wrapper(a){function b(b,c){var d=crypto(a.hash),e=fs.readFileSync(c);return d.update(e),b?(b.hash=d.digest("hex"),b):"<hash>"+d.digest("hex")+"</hash>"}function c(b,c){var d;if(a.cache&&STORY.root===a.root){if(d=fs.statSync(a.root),d&&STORY.mtime===d.mtime.getTime()&&STORY.json===a.json&&STORY.hash===a.hash)return STORY.body;STORY=Object.create(null)}var e;return e=g(a.root,b,""),c&&(e+=c),a.cache&&(d=fs.statSync(a.root),d&&(STORY.root=a.root,STORY.body=e,STORY.mtime=d.mtime.getTime(),STORY.json=a.json,STORY.hash=a.hash)),e}function d(b,c){var d;return d=g(a.root,b,""),c&&(d+=c),d}function e(a,b,c,d,e,f,g){var j,l;return j=f?h++:i++,a[g]?l=a[g][j]=Object.create(null):(a[g]=Object.create(null),l=a[g][j]=Object.create(null)),l.name=c,l.ctime=e.ctime.getTime(),l.mtime=e.mtime.getTime(),f?l.type="dir":(l.atime=e.atime.getTime(),l.size=e.size,l=k(l,d),l.type="file"),[a,null]}function f(a,b,c,d,e,f){var g="",j="";return g=f?'<dir id="'+h++ +'">':'<file id="'+i++ +'">',g+="<name>"+c+"</name>",g+="<ctime>"+e.ctime.getTime()+"</ctime>",g+="<mtime>"+e.mtime.getTime()+"</mtime>",f?j="</dir>":(g+="<atime>"+e.atime.getTime()+"</atime>",g+="<size>"+e.size+"</size>",g+=k(!1,d),g+="</file>"),[a+g,b+j]}function g(b,c,d){var e=c,f=d,h=fs.statSync(b);if(h){var i=fs.readdirSync(b);if(i)for(var j=0,k=i.length;k>j;j++){var m=i[j];if(!(a.exclude&&a.exclude.test(m)||a.dotfiles&&"."===m[0])){var n=b+PATH.sep+m,o=fs.statSync(n);if(o){var p,q,r;o.isDirectory()?(p=l(e,f,m,n,o,!0,b),q=p[0],r=p[1],e=g(n,q,r),f=""):(p=l(e,f,m,n,o,!1,b),e=p[0],f=p[1])}}}}return f&&(e+=f),e}var h=0,i=0,j=d;a.cache&&(j=c);var k=b;a.hash||(k=function(a){return a?a:""});var l=f;return a.json?(l=e,j(Object.create(null),null)):j(header,footer)}function dir(a,b){if(!a)throw new TypeError("root path required");var c=resolve(a);if("/"==c[c.length-1]&&(c=c.substr(0,c.length-1)),!fs.existsSync(a))throw new Error("path not exists");if(!fs.statSync(c).isDirectory())throw new Error("path is not a directory");var d=b||Object.create(null),e={root:c,exclude:d.exclude||!1,dotfiles:d.dotfiles===!1?!1:!0,cache:d.cache===!1?!1:!0,json:Boolean(d.json),hash:d.hash===!1?!1:String(d.hash||"md5")};return wrapper(e)}try{var PATH=require("path"),crypto=require("crypto").createHash,fs=require("fs"),resolve=PATH.resolve}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}var STORY=Object.create(null),header='<?xml version="1.0" encoding="UTF-8"?><home>',footer="</home>";module.exports=dir;
